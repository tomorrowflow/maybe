<%# locals: (account:) %>

<div class="grid grid-cols-3 gap-2">
  <%= summary_card title: t(".original_principal") do %>
    <%= format_money account.loan.original_balance %>
  <% end %>

  <%= summary_card title: t(".remaining_principal") do %>
    <%= format_money account.balance_money %>
  <% end %>

  <%= summary_card title: t(".interest_rate") do %>
    <% if account.loan.sollzins.present? %>
      <div><%= number_to_percentage(account.loan.sollzins, precision: 3) %></div>
      <% if account.loan.effektivzins.present? %>
        <div class="text-xs text-gray-500">APR: <%= number_to_percentage(account.loan.effektivzins, precision: 3) %></div>
      <% end %>
    <% else %>
      <%= t(".unknown") %>
    <% end %>
  <% end %>

  <%= summary_card title: t(".monthly_payment") do %>
    <% if account.loan.rate_type.present? && account.loan.rate_type != 'fixed' %>
      <%= t(".not_applicable") %>
    <% elsif account.loan.rate_type == 'fixed' && account.loan.monthly_payment.present? %>
      <%= format_money(account.loan.monthly_payment) %>
    <% else %>
      <%= t(".unknown") %>
    <% end %>
  <% end %>

  <%= summary_card title: t(".term") do %>
    <% if account.loan.term_months.present? %>
      <% if account.loan.term_months < 12 %>
        <%= pluralize(account.loan.term_months, "month") %>
      <% else %>
        <%= pluralize(account.loan.term_months / 12, "year") %>
      <% end %>
    <% else %>
      <%= t(".unknown") %>
    <% end %>
  <% end %>

  <%= summary_card title: t(".type") do %>
    <%= account.loan.rate_type&.titleize || t(".unknown") %>
  <% end %>

  <% if account.loan.fixed_rate_end_date.present? %>
    <%= summary_card title: "Fixed Rate Until" do %>
      <div><%= account.loan.fixed_rate_end_date.strftime("%b %d, %Y") %></div>
      <% if account.loan.fixed_rate_ending_soon? %>
        <div class="text-xs text-yellow-600 font-medium">⚠️ Ends in <%= account.loan.days_until_fixed_rate_end %> days</div>
      <% end %>
    <% end %>
  <% end %>

  <% if account.loan.maturity_date.present? %>
    <%= summary_card title: "Maturity Date" do %>
      <%= account.loan.maturity_date.strftime("%b %d, %Y") %>
    <% end %>
  <% end %>

  <% if account.loan.extra_payment_allowance_percent.present? %>
    <%= summary_card title: "Extra Payment Allowance" do %>
      <%= number_to_percentage(account.loan.extra_payment_allowance_percent, precision: 2) %> per year
    <% end %>
  <% end %>
</div>

<div class="flex justify-center py-8">
  <%= render DS::Link.new(
    text: "Edit loan details",
    variant: "ghost",
    href: edit_loan_path(account),
    frame: :modal
  ) %>
</div>
