<%# locals: (account:) %>

<% loan = account.private_loan %>

<div class="space-y-6">
  <%# Loan Overview %>
  <div class="grid grid-cols-3 gap-2">
    <%= summary_card title: "Principal Amount" do %>
      <%= format_money loan.principal_money %>
    <% end %>

    <%= summary_card title: "Outstanding Balance" do %>
      <%= format_money account.balance_money %>
    <% end %>

    <%= summary_card title: "Repayment Progress" do %>
      <%= number_to_percentage(loan.repayment_progress_percent, precision: 1) %>
    <% end %>
  </div>

  <%# Status Alert %>
  <% if loan.past_due? %>
    <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
      <div class="flex items-center gap-2 text-red-800">
        <%= icon "alert-triangle", class: "w-5 h-5" %>
        <span class="text-sm font-medium">This loan is past due!</span>
      </div>
      <p class="text-xs text-red-600 mt-1">
        Maturity date was <%= loan.maturity_date.strftime("%B %d, %Y") %>
      </p>
    </div>
  <% end %>

  <%# Borrower Information %>
  <% if loan.borrower_name.present? %>
    <div class="bg-container rounded-lg p-4 border border-primary">
      <h3 class="text-sm font-medium text-secondary mb-3">Borrower</h3>
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center">
          <%= icon "user", class: "w-5 h-5 text-purple-600" %>
        </div>
        <div>
          <p class="text-primary font-medium"><%= loan.borrower_name %></p>
          <% if loan.borrower_notes.present? %>
            <p class="text-xs text-tertiary"><%= loan.borrower_notes %></p>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>

  <%# Interest & Payment Details %>
  <% if loan.interest_rate.present? && loan.interest_rate > 0 %>
    <div class="bg-container rounded-lg p-4 border border-primary">
      <h3 class="text-sm font-medium text-secondary mb-3">Interest & Payments</h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div>
          <div class="text-xs text-tertiary">Interest Rate</div>
          <div class="text-lg font-semibold">
            <%= number_to_percentage(loan.interest_rate, precision: 2) %>
          </div>
          <div class="text-xs text-tertiary"><%= loan.rate_type_description %></div>
        </div>

        <% if loan.monthly_payment_money %>
          <div>
            <div class="text-xs text-tertiary">Monthly Payment</div>
            <div class="text-lg font-semibold">
              <%= format_money loan.monthly_payment_money %>
            </div>
          </div>
        <% end %>

        <% if loan.total_interest_money %>
          <div>
            <div class="text-xs text-tertiary">Total Interest</div>
            <div class="text-lg font-semibold text-green-600">
              +<%= format_money loan.total_interest_money %>
            </div>
          </div>
        <% end %>

        <% if loan.total_repayment_money %>
          <div>
            <div class="text-xs text-tertiary">Total Repayment</div>
            <div class="text-lg font-semibold">
              <%= format_money loan.total_repayment_money %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Timeline %>
  <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
    <% if loan.start_date.present? %>
      <%= summary_card title: "Loan Start" do %>
        <%= loan.start_date.strftime("%B %d, %Y") %>
        <% if loan.elapsed_months %>
          <div class="text-xs text-tertiary"><%= loan.elapsed_months %> months ago</div>
        <% end %>
      <% end %>
    <% end %>

    <% if loan.maturity_date.present? %>
      <%= summary_card title: "Maturity Date" do %>
        <%= loan.maturity_date.strftime("%B %d, %Y") %>
        <% if loan.months_until_maturity && loan.months_until_maturity > 0 %>
          <div class="text-xs text-tertiary"><%= loan.months_until_maturity %> months remaining</div>
        <% end %>
      <% end %>
    <% end %>

    <% if loan.term_months.present? %>
      <%= summary_card title: "Term" do %>
        <%= loan.term_months %> months
        <div class="text-xs text-tertiary"><%= loan.repayment_type_description %></div>
      <% end %>
    <% end %>
  </div>

  <%# Contract Details %>
  <% if loan.has_written_contract? || loan.has_collateral? || loan.contract_number.present? %>
    <div class="bg-container rounded-lg p-4 border border-primary">
      <h3 class="text-sm font-medium text-secondary mb-3">Documentation</h3>
      <div class="flex flex-wrap gap-2">
        <% if loan.has_written_contract? %>
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
            <%= icon "file-text", class: "w-3 h-3 mr-1" %>
            Written Contract
          </span>
        <% end %>

        <% if loan.has_collateral? %>
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
            <%= icon "shield", class: "w-3 h-3 mr-1" %>
            Secured
            <% if loan.collateral_description.present? %>
              (<%= loan.collateral_description %>)
            <% end %>
          </span>
        <% end %>

        <% if loan.contract_number.present? %>
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
            Ref: <%= loan.contract_number %>
          </span>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<div class="flex justify-center py-8">
  <%= render DS::Link.new(
    text: "Edit loan details",
    variant: "ghost",
    href: edit_private_loan_path(account),
    frame: :modal
  ) %>
</div>
